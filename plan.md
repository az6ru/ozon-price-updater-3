# План разработки Ozon Price Updater 3.0

## 1. Обзор проекта

Ozon Price Updater 3.0 - система автоматизации мониторинга и корректировки цен на маркетплейсе Ozon, которая позволяет:
- Получать актуальную информацию о товарах продавца
- Мониторить цены на витрине маркетплейса
- Автоматически корректировать цены в соответствии с МРЦ и заданными скидками
- Вести журнал изменений и логи API-запросов

## 2. Архитектура системы

### 2.1 Компоненты
- API Server (FastAPI)
- База данных (SQLite)
- Планировщик задач (APScheduler)
- Клиентские API модули (Ozon Seller API, Front Price API)
- Веб-интерфейс (NuxtJS + Vue 3)

### 2.2 Взаимодействие компонентов
- Web Interface → FastAPI Server → SQLite Database
- FastAPI Server → APScheduler
- APScheduler → Ozon API Client → Ozon Seller API
- APScheduler → Front Price API Client → Front Price API

## 3. Этапы разработки

### 3.1 Настройка проекта (Неделя 1)
- [x] Создание базовой структуры проекта
- [ ] Настройка конфигурации FastAPI
- [ ] Настройка базы данных SQLite и моделей
- [ ] Настройка аутентификации и авторизации
- [ ] Настройка окружения разработки

### 3.2 Разработка серверной части (Недели 2-3)
- [ ] Реализация API модуля для Ozon Seller API
  - [ ] Получение списка товаров
  - [ ] Получение подробной информации о товарах
  - [ ] Обновление цен товаров
- [ ] Реализация API модуля для Front Price API
  - [ ] Получение цен товаров с витрины
- [ ] Разработка основных эндпоинтов API
  - [ ] Управление товарами
  - [ ] Мониторинг и статистика
  - [ ] Настройки системы
- [ ] Реализация планировщика задач
  - [ ] Задача мониторинга товаров
  - [ ] Задача поддержания цен МРЦ
  - [ ] Задача проверки изменения цен

### 3.3 Разработка клиентской части (Недели 4-5)
- [ ] Настройка проекта NuxtJS
- [ ] Разработка страниц
  - [ ] Страница авторизации
  - [ ] Дашборд
  - [ ] Список товаров
  - [ ] Страница изменения МРЦ и скидок
  - [ ] История изменения цен
  - [ ] Журнал API-запросов
  - [ ] Настройки
- [ ] Реализация интерфейсных компонентов
  - [ ] Таблица товаров с фильтрацией и поиском
  - [ ] Формы редактирования МРЦ и скидок
  - [ ] Графики и статистика

### 3.4 Интеграция и тестирование (Неделя 6)
- [ ] Интеграционное тестирование API
- [ ] End-to-end тестирование UI
- [ ] Нагрузочное тестирование
- [ ] Отладка и исправление ошибок

### 3.5 Деплой и документация (Неделя 7)
- [ ] Подготовка к деплою
- [ ] Написание документации
- [ ] Создание инструкций по развертыванию
- [ ] Финальное тестирование

## 4. Структура проекта

### 4.1 Бэкенд (FastAPI)
```
backend/
├── app/
│   ├── api/
│   │   ├── routes/
│   │   │   ├── auth.py
│   │   │   ├── products.py
│   │   │   ├── price_history.py
│   │   │   ├── api_logs.py
│   │   │   └── settings.py
│   │   ├── dependencies.py
│   │   └── api.py
│   ├── core/
│   │   ├── config.py
│   │   ├── security.py
│   │   └── logging.py
│   ├── db/
│   │   ├── models.py
│   │   ├── schemas.py
│   │   └── database.py
│   ├── services/
│   │   ├── ozon_api.py
│   │   ├── front_price_api.py
│   │   └── price_calculator.py
│   ├── tasks/
│   │   ├── monitor_products.py
│   │   ├── maintain_mrpc_prices.py
│   │   └── verify_price_changes.py
│   └── main.py
├── tests/
│   ├── api/
│   ├── services/
│   └── tasks/
├── requirements.txt
└── README.md
```

### 4.2 Фронтенд (NuxtJS + Vue 3)
```
frontend/
├── components/
│   ├── auth/
│   ├── dashboard/
│   ├── products/
│   ├── history/
│   ├── logs/
│   └── settings/
├── composables/
│   ├── useAuth.ts
│   ├── useProducts.ts
│   ├── useHistory.ts
│   ├── useLogs.ts
│   └── useSettings.ts
├── layouts/
│   ├── default.vue
│   └── auth.vue
├── pages/
│   ├── index.vue
│   ├── login.vue
│   ├── products/
│   │   ├── index.vue
│   │   └── [id].vue
│   ├── history.vue
│   ├── logs.vue
│   └── settings.vue
├── public/
├── server/
│   └── api/
├── nuxt.config.ts
├── package.json
└── README.md
```

## 5. Технические детали

### 5.1 API эндпоинты
Основные API эндпоинты системы:
- `/api/products` - получение списка товаров
- `/api/products/fetch` - получение данных о товарах из Ozon API
- `/api/products/fetch-prices` - получение цен с витрины
- `/api/products/set-mrpc` - установка МРЦ для товаров
- `/api/products/set-discount` - установка скидок для товаров
- `/api/products/{product_id}/activate` - активация мониторинга товара
- `/api/products/{product_id}/deactivate` - деактивация мониторинга товара
- `/api/products/update-prices` - принудительное обновление цен
- `/api/price-history` - история изменения цен
- `/api/api-logs` - журнал API-запросов
- `/api/settings` - получение и обновление настроек

### 5.2 Модели базы данных
Основные таблицы в базе данных:
- `sku_monitoring` - информация о товарах
- `price_history` - история изменения цен
- `api_log_entry` - журнал API-запросов

### 5.3 Алгоритм расчета цен
Основная логика для расчета цен и поддержания МРЦ:
1. МРЦ - фиксированная цена, которую мы хотим видеть на витрине
2. Управление скидкой происходит через old_price:
   - price = МРЦ (всегда фиксирована)
   - old_price = МРЦ / (1 - скидка/100)

### 5.4 Интеграция с внешними API
#### Ozon Seller API
- Получение списка товаров
- Получение информации о товарах
- Обновление цен товаров

#### Front Price API
- Получение цен с витрины Ozon

## 6. Требования и ограничения

### 6.1 Технические требования
- Python 3.9+
- Node.js 16+
- SQLite 3.0+

### 6.2 Зависимости
- FastAPI
- SQLAlchemy
- Pydantic
- APScheduler
- aiohttp
- NuxtJS 3
- Vue 3
- Tailwind CSS
- Shadcn Vue/Radix Vue

### 6.3 Ограничения
- Лимит API Ozon: 10 изменений цены в час для конкретного product_id
- Оптимизация под нагрузку до 5000 товаров

## 7. Мониторинг и логирование

### 7.1 Логирование
- Логирование всех API запросов к внешним сервисам
- Логирование изменений цен
- Логирование ошибок и исключений

### 7.2 Мониторинг
- Endpoint для проверки состояния системы (/health)
- Метрики Prometheus для мониторинга производительности

## 8. Безопасность

### 8.1 Авторизация
- Аутентификация на основе сессий
- Защита API эндпоинтов от несанкционированного доступа

### 8.2 Защита данных
- Шифрование секретных ключей и API-токенов
- Безопасное хранение учетных данных

## 9. Будущие улучшения

### 9.1 Возможные расширения системы
- Поддержка других маркетплейсов (Wildberries, Яндекс.Маркет)
- Расширенная аналитика и рекомендации по ценообразованию
- Интеграция с системами учета товаров и ERP
- Модуль уведомлений (email, telegram)
- API для интеграции с внешними системами 